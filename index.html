<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <title>SuperBond</title>
    <meta name="description" content="">
    <meta name="author" content="subond">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="./theme/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="./theme/bootstrap.min.css" rel="stylesheet">
    <link href="./theme/bootstrap.min.responsive.css" rel="stylesheet">
    <link href="./theme/local.css" rel="stylesheet">
    <link href="./theme/pygments.css" rel="stylesheet">

    <!-- So Firefox can bookmark->"abo this site" -->
        <link href="www.subond.com/feeds/all.atom.xml" rel="alternate" title="SuperBond" type="application/atom+xml">

</head>

<body>

<div class="navbar">
    <div class="navbar-inner">
    <div class="container">

         <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
         </a>

        <a class="brand" href=".">SuperBond</a>

        <div class="nav-collapse">
        <ul class="nav">
            
            <li><a href="./pages/about-me.html">About Me</a></li>
            <li><a href="./pages/my_reading_list.html">我的书单</a></li>
        </ul>
        </div>
        
    </div>
    </div>
</div>

<div class="container">
    <div class="content">
    <div class="row">

        <div class="span9">
        

        


    <div class='article'>
        <div class="content-title">
            <a href="./pages/2018/05/07/p4_helloworld.html"><h1>P4编程实战</h1></a>
2018-05-07

by <a class="url fn" href="./author/subond.html">subond</a>
 


 
        </div>
        
        <div><h3>不同子网的通信</h3>
<p>利用p4编程强大的数据包处理能力，实现两个子网数据报的通信。</p>
<p>子网1: 192.168.1.0/24
子网2: 192.168.2.0/24</p>
<h3>编程思路</h3>
<p>采用gre隧道的方式，将两个子网的数据包包裹在gre报文的内部，外部使用gre隧道进行通信。</p>
<h3>核心代码</h3>
<div class="highlight"><pre><span></span><span class="err">#</span> <span class="nx">Ingress</span> <span class="nx">pipeline</span>
<span class="nx">control</span> <span class="nx">dataplane_route</span> <span class="p">{</span>
    <span class="nx">apply</span><span class="p">(</span><span class="nx">l3_or_l2</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">l3_pkt</span> <span class="p">{</span>
            <span class="nx">apply</span><span class="p">(</span><span class="nx">host</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nx">table</span> <span class="nx">l3_or_l2</span> <span class="p">{</span>
    <span class="nx">reads</span> <span class="p">{</span>
        <span class="nx">inner_ethernet</span><span class="p">.</span><span class="nx">dstAddr</span> <span class="p">:</span> <span class="nx">exact</span><span class="p">;</span>
        <span class="nx">inner_ipv4</span> <span class="p">:</span> <span class="nx">valid</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">actions</span> <span class="p">{</span>
        <span class="nx">l3_pkt</span><span class="p">;</span>
        <span class="nx">l2_pkt</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">default_action</span> <span class="p">:</span> <span class="nx">l2_pkt</span><span class="p">();</span>
    <span class="nx">size</span> <span class="p">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">table</span> <span class="nx">host</span> <span class="p">{</span>
    <span class="nx">reads</span> <span class="p">{</span>
        <span class="nx">gretap</span><span class="p">.</span><span class="nx">tunnelId</span> <span class="p">:</span> <span class="nx">exact</span><span class="p">;</span>
        <span class="nx">inner_ipv4</span><span class="p">.</span><span class="nx">dstAddr</span> <span class="p">:</span> <span class="nx">exact</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">actions</span> <span class="p">{</span>
        <span class="nx">on_miss</span><span class="p">;</span>
        <span class="nx">forward_to</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">default_action</span> <span class="p">:</span> <span class="nx">on_miss</span><span class="p">();</span>
    <span class="nx">size</span> <span class="p">:</span> <span class="mi">10</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<div class="highlight"><pre><span></span># Egress
table mac_info {
    reads {
        inner_ethernet.dstAddr : exact;
    }

    actions {
        forward_data;
        drop_act;
    }

    default_action : drop_act();
    size : 10;
}

table switch_pkt {
    reads {
        inner_ethernet.dstAddr : exact;
        inner_ipv4 : valid;
    }

    actions {
        is_switch;
        on_miss;
    }

    default_action : is_switch();
    size : 1;
}

control dataplane_switch {
    apply(switch_pkt) {
        is_switch {
            apply(mac_info);
        }
    }
}
</pre></div></div>
        <hr />
    </div>
		

 
        

 

    <div class='article'>
        <a href="./pages/2018/05/05/p4_arch.html"><h2>P4:转发平面的编程语言</h2></a>
        <div class= "well small"> 2018-05-05

by <a class="url fn" href="./author/subond.html">subond</a>
 


 </div>
        <div class="summary"><p>P4是一种声明性语言，用来表示数据包如何通过网络转发单元的流水线(Pipeline)进行处理，基于抽象转发模型，该模型由解析器(Parser)和一系列匹配+动表(Match+Action Table)组成，分为入口(Ingress)和出口(Egress)两部分。Parser定义了每个传入数据包的包头格式，用于解析数据包。每个Match+Action表对包头字段进行查找和匹配，并在每个表内应用第一个匹配相对应的动作(Action)。</p> <a class="btn btn-info xsmall" href="./pages/2018/05/05/p4_arch.html">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="./pages/2018/05/01/grpc_helloworld.html"><h2>gRPC使用指南</h2></a>
        <div class= "well small"> 2018-05-01

by <a class="url fn" href="./author/subond.html">subond</a>
 


 </div>
        <div class="summary"><p>gRPC是一个高性能、开源、通用的RPC框架，面向移动和HTTP/2设计，并且提供多个语言版本支持。本文章基于golang语言，通过概述和一个简单的HelloWorld来介绍gRPC的基本概念和使用方法。</p> <a class="btn btn-info xsmall" href="./pages/2018/05/01/grpc_helloworld.html">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="./pages/2017/11/19/confident_and_certainty.html"><h2>年轻的自信与成熟的笃定</h2></a>
        <div class= "well small"> 2017-11-19

by <a class="url fn" href="./author/subond.html">subond</a>
 


 </div>
        <div class="summary"><p>当一个年轻人开始逐渐摆脱盲目自信的时候，脚步更加坚定的时候，他迎来的是更加成熟的笃定。</p> <a class="btn btn-info xsmall" href="./pages/2017/11/19/confident_and_certainty.html">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="./pages/2017/11/08/two_fundamental_truths_about_work.html"><h2>关于找工作的两个基本事实</h2></a>
        <div class= "well small"> 2017-11-08

by <a class="url fn" href="./author/subond.html">subond</a>
 


 </div>
        <div class="summary"><p>对于应届毕业生而言，由于缺乏工作经验，对工作环境缺少了解，往往不能够很快地进入工作状态。这时候，如果能够获得一份不错的实习机会，对今后的工作可以说是大有裨益。</p> <a class="btn btn-info xsmall" href="./pages/2017/11/08/two_fundamental_truths_about_work.html">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="./pages/2017/10/08/starting_job.html"><h2>初入职场</h2></a>
        <div class= "well small"> 2017-10-08

by <a class="url fn" href="./author/subond.html">subond</a>
 


 </div>
        <div class="summary"><p>“如何有机会让现在的你遇到刚毕业初入职场的你，你会对他说什么？”这是一个知乎上的问题，以下的回答部门节选自冯大辉。</p> <a class="btn btn-info xsmall" href="./pages/2017/10/08/starting_job.html">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="./pages/2017/05/15/vagrant_usage.html"><h2>Vagrant使用案例</h2></a>
        <div class= "well small"> 2017-05-15

by <a class="url fn" href="./author/subond.html">subond</a>
 


 </div>
        <div class="summary"><h2>1.单机配置</h2>
<p>1) 配置一个centos7系统，要求使用私有网络地址<code>192.168.10.10</code>，hostname为dbserver。</p>
<div class="highlight"><pre><span></span><span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">dbserver</span><span class="o">|</span>
  <span class="n">dbserver</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&quot;centos/7&quot;</span>
  <span class="n">dbserver</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="s2">&quot;private_network&quot;</span><span class="p">,</span> <span class="ss">ip</span><span class="p">:</span> <span class="s2">&quot;192.168.10.10&quot;</span>
  <span class="n">dbserver</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="s2">&quot;dbserver&quot;</span>
<span class="k">end</span>
</pre></div>


<p>需要说明的是：使用私有地址，vm的私有ip只能在各vm间互访，而不能访问Internet，即HOST_ONLY模式；使用公有地址，vm的公有地址将于主机某个网卡(启动vm时需指定)的地址同一网段，vm能够使用该地址访问Internet。</p>
<p>2) 配置一个ubuntu xenial64系统，并将工程目录下的<code>data</code>目录同步到vm中 …</p> <a class="btn btn-info xsmall" href="./pages/2017/05/15/vagrant_usage.html">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="./pages/2017/05/10/vagrant_startup.html"><h2>Vagrant的快速使用</h2></a>
        <div class= "well small"> 2017-05-10

by <a class="url fn" href="./author/subond.html">subond</a>
 


 </div>
        <div class="summary"><p>Vagrant是为了方便的实现虚拟化环境而设计的，使用Ruby语言开发，基于VirtualBox等虚拟机管理软件的接口，提供了一个可配置、轻量级的便携式虚拟开发环境。使用Vagrant可以很方便的就建立起来一个虚拟环境，而且可以模拟多台虚拟机，形成分布式系统。</p> <a class="btn btn-info xsmall" href="./pages/2017/05/10/vagrant_startup.html">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="./pages/2017/05/01/docker-swarm-jin-jie2.html"><h2>Docker进阶：服务配置</h2></a>
        <div class= "well small"> 2017-05-01

by <a class="url fn" href="./author/subond.html">subond</a>
 


 </div>
        <div class="summary"><p>当使用Docker Swarm模式时，我们可以通过命令<code>docker service create</code>向Swarm集群部署应用服务。Swarm集群中的管理节点将服务描述视为应用服务所需的状态。其次，所有服务相关的命令，即<code>docker service</code>，一定要在管理节点上运行(管理节点负责Swarm集群中的服务管理和任务编排)。</p> <a class="btn btn-info xsmall" href="./pages/2017/05/01/docker-swarm-jin-jie2.html">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="./pages/2017/04/28/docker-swarm-jin-jie1.html"><h2>Docker进阶：以Swarm模式运行Docker引擎</h2></a>
        <div class= "well small"> 2017-04-28

by <a class="url fn" href="./author/subond.html">subond</a>
 


 </div>
        <div class="summary"><p>Docker Engine 1.12及后续版本支持Swarm模式，我们可以通过以下两种方式开始Swarm模式：创建一个Swarm集群和加入一个已有的Swarm集群。</p> <a class="btn btn-info xsmall" href="./pages/2017/04/28/docker-swarm-jin-jie1.html">read more</a></div>
    </div>	
				
<div class="pagination">
<ul>
    <li class="prev disabled"><a href="#">&larr; Previous</a></li>

    <li class="active"><a href="./index.html">1</a></li>
    <li class=""><a href="./index2.html">2</a></li>
    <li class=""><a href="./index3.html">3</a></li>
    <li class=""><a href="./index4.html">4</a></li>

    <li class="next"><a href="./index2.html">Next &rarr;</a></li>

</ul>
</div>
 
  
        </div>
        
        <div class="span3">

            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Site
                </li>
            
                <li><a href="./archives.html">Archives</a>
                <li><a href="./tags.html">Tags</a>



                <li><a href="www.subond.com/feeds/all.atom.xml" rel="alternate">Atom feed</a></li>

            </ul>
            </div>


            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Categories
                </li>
                
                <li><a href="./category/life.html">Life</a></li>
                <li><a href="./category/note.html">Note</a></li>
                <li><a href="./category/read.html">Read</a></li>
                <li><a href="./category/tech.html">Tech</a></li>
                <li><a href="./category/tips.html">Tips</a></li>
                   
            </ul>
            </div>


            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Links
                </li>
            
                <li><a href="https://www.ucloud.cn">UCloud</a></li>
                <li><a href="http://www.infoq.com/cn/">InfoQ</a></li>
                <li><a href="http://www.sdnlab.com/">SDNLAB</a></li>
                <li><a href="https://bbs.byr.cn/">BYR</a></li>
            </ul>
            </div>


            <div class="social">
            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Social
                </li>
           
                <li><a href="https://github.com/yusubond">Github</a></li>
                <li><a href="https://www.linkedin.com/in/subond-yu-523281146/">LinkedIn</a></li>
                <li><a href="http://weibo.com/ybconly">Weibo</a></li>
                <li><a href="http://subond.lofter.com/">Lofter</a></li>
            </ul>
            </div>
            </div>

        </div>  
    </div>     </div> 
<footer>
<br />
<p><a href=".">SuperBond</a> &copy; subond 2018</p>
</footer>

</div> <!-- /container -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="./theme/bootstrap-collapse.js"></script>
<script>var _gaq=[['_setAccount','UA-45955656-1'],['_trackPageview']];(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.src='//www.google-analytics.com/ga.js';s.parentNode.insertBefore(g,s)}(document,'script'))</script>
 
</body>
</html>