<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="referrer" content="no-referrer-when-downgrade">
    

    <title>Docker技术：认识Docker | 凯文的个人博客</title>
    <meta property="og:title" content="Docker技术：认识Docker - 凯文的个人博客">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2017-04-14T00:00:00&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2023-03-20T11:54:04&#43;08:00'>
        
    <meta name="Keywords" content="golang,博客">
    <meta name="description" content="Docker技术：认识Docker">
        <meta name="author" content="subond">
        
    <meta property="og:url" content="http://www.subond.com/post/2017-04-14_docker_docker/">
    <link rel="shortcut icon" href='/favicon.ico'  type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
    
    
    
</head>

<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="http://www.subond.com/">
                        凯文的个人博客
                    </a>
                
                <p class="description">专注于云计算网络，个人成长</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="http://www.subond.com/">首页</a>
                    
                    <a  href="http://www.subond.com/archives/" title="归档">归档</a>
                    
                    <a  href="http://www.subond.com/reading/" title="阅读">阅读</a>
                    
                    <a  href="http://www.subond.com/about/" title="关于我">关于我</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    
    <article class="post">
        <header>
            <h1 class="post-title">Docker技术：认识Docker</h1>
        </header>
        <date class="post-meta meta-date">
            2017年4月14日
        </date>
        
        <div class="post-meta">
            <span>|</span>
            
            <span class="meta-category">
                <a href='/categories/%E6%8A%80%E6%9C%AF' target="_blank">技术</a>
            </span>
            
        </div>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="post-content">
            <p>Docker和传统虚拟化方式的不同如下图所示。传统虚拟化技术是虚拟出一套硬件，在其上运行一个完整操作系统，再在该系统之上再运行所需的应用进程；而容器内的应用进程直接运行于宿主的内核，容器内没有自己的内核，而且也没有进行硬件虚拟。</p>
<p>本文目录：</p>
<ul>
<li><a href="#1.%E4%BB%80%E4%B9%88%E6%98%AFDocker">1.什么是Docker</a></li>
<li><a href="#2.Docker%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5">2.Docker基本概念</a></li>
<li><a href="#3.Docker%E5%AE%89%E8%A3%85">3.Docker安装</a></li>
<li><a href="#4.Docker%E7%BD%91%E7%BB%9C">4.Docker网络</a></li>
</ul>
<h3 id="1什么是docker">1.什么是Docker</h3>
<p>Docker是使用Go语言进行开发实现，基于Linux内核的cgroup, namespace, 以及AUFS类的Union FS等技术，对 <strong>进程</strong> 进行封装隔离，属于 <strong>操作系统层面的虚拟化技术</strong>。<em>由于隔离的进程独立于宿主和其他隔离的进程，因此成为容器</em>。</p>
<p>Docker和传统虚拟化方式的不同如下图所示。传统虚拟化技术是虚拟出一套硬件，在其上运行一个完整操作系统，再在该系统之上再运行所需的应用进程；而容器内的 <strong>应用进程直接运行于宿主的内核，容器内没有自己的内核，而且也没有进行硬件虚拟</strong>。</p>
<p>
        <img class="mx-auto" alt="Docker与虚拟化技术" src="http://on64c9tla.bkt.clouddn.com/2017A/Docker-vm.png" />   
    </p>
<h3 id="2docker基本概念">2.Docker基本概念</h3>
<p>Docker包括三个基本概念：<strong>镜像</strong>、<strong>容器</strong>、<strong>仓库</strong>。</p>
<p><strong>1 镜像(Image)</strong></p>
<p>众所周知，操作系统分为内核和用户空间。对于Linux而言，内核启动后，会挂载<code>root</code>文件系统为其提供用户空间支持。而Docker镜像，就相当于一个<code>root</code>文件系统。</p>
<p>Docker镜像是一个特殊的文件系统，除了提供容器运行时所需的程序、库、资源、配置等文件，也包含一些为应用运行时准备的配置参数。<strong>镜像不包含任何动态数据，其内容在构建之后也不会被改变</strong>。</p>
<p><strong>分层存储</strong></p>
<p>镜像在构建时，一层层构建，前一层是后一层的基础。每一层构建完成后就不会再发生改变，后一层上的任何改变值发生在自己这一层。当我们使用命令<code>docker pull ubuntu:14.04</code>获取ubuntu14.04镜像时，可以看到每一层的镜像，及其相互依赖关系。</p>
<pre tabindex="0"><code># 获取DockerHub中的ubuntu14.04镜像
$ docker pull ubuntu:16.04
16.04: Pulling from library/ubuntu
b6f892c0043b: Pull complete
55010f332b04: Pull complete
2955fb827c94: Pull complete
3deef3fcbd30: Pull complete
cf9722e506aa: Pull complete
Digest: sha256:382452f82a8bbd34443b2c727650af46aced0f94a44463c62a9848133ecb1aa8
Status: Downloaded newer image for ubuntu:16.04
# 可以看到，整个ubuntu16.04镜像由五层存储构成

# 仓库的元数据
# 在文件/var/lib/docker/image/graph_dirver/repositories.json中可以看到仓库的元数据
$ cat repositories.json | python -mjson.tool
{
    &#34;Repositories&#34;: {
        &#34;ubuntu&#34;: {
            &#34;ubuntu:16.04&#34;: &#34;sha256:ebcd9d4fca80e9e8afc525d8a38e7c56825dfb4a220ed77156f9fb13b14d4ab7&#34;,
            &#34;ubuntu@sha256:382452f82a8bbd34443b2c727650af46aced0f94a44463c62a9848133ecb1aa8&#34;: &#34;sha256:ebcd9d4fca80e9e8afc525d8a38e7c56825dfb4a220ed77156f9fb13b14d4ab7&#34;
        }
    }
}

# 镜像的元数据
# 在文件/var/lib/docker/image/graph_dirver/imagedb/content/sha256/[image_id]中可以看到镜像的元数据
# 命令cat image_id | python -mjson.tool

# 镜像层的元数据
# 在文件/var/lib/docker/image/graph_dirver/layerdb/sha256/[chain_id]
# [chain_id]是某一层镜像层的存储索引
</code></pre><p><strong>2 容器(Container)</strong></p>
<p><strong>容器的实质是进程</strong>。每一个容器运行时，是以镜像为基础层，在其上创建一个当前容器的存储层，称为“容器存储层”。容器存储层的生命周期与容器一样，容器消亡时，容器存储层也随之消亡。因此，任何保存在容器存储层的信息都会随容器删除而丢失。</p>
<p>容器是Docker的核心概念。简单来讲，容器是 <strong>独立运行的一个或一组应用，以它们的运行态环境</strong>。与之对应的，容易混淆的概念是虚拟机。虚拟机可以理解为 <strong>模拟运行的一整套操作系统(包括运行态环境和其他系统环境)和运行在操作系统上的应用</strong>。</p>
<p>容器的核心为所执行的应用程序，所需要的资源都是应用程序所必需的的。当Docker容器中指定的应用终结时，容器也自动终止。当利用<code>docker run</code>创建容器时，Docker在后台运行的标准操作包括：</p>
<ul>
<li>检查本地是否存在指定的镜像，不存在就从公有仓库下载</li>
<li>利用镜像创建并启动一个容器</li>
<li>分配一个文件系统，并在只读的镜像层外面挂载一层可读写层</li>
<li>从宿主主机配置的网桥接口中桥接一个虚拟接口到容器中</li>
<li>从地址池配置一个ip地址给容器</li>
<li>执行用户指定的应用程序</li>
<li>执行完毕后容器被终止</li>
</ul>
<p><strong>3 仓库(Repository)</strong></p>
<p>仓库(Repository)是集中存放镜像的地方，每个仓库下面有多个镜像。因此，仓库可以被认为是一个具体的项目或目录。仓库分为公有仓库和本地仓库(私有仓库)，公有仓库Docker Hub由Docker公司或用户维护，主要包括根镜像和用户镜像；而本地仓库可供私人使用。</p>
<h3 id="3docker安装">3.Docker安装</h3>
<p>对于Ubuntu系列，Docker CE支持以下三种64位发行版：</p>
<ul>
<li>Yakkety 16.10</li>
<li>Xenial 16.04</li>
<li>Trusty 14.04</li>
</ul>
<p>第一步：设置仓库。可以通过<code>lsb_release -cs</code>命令查看Ubuntu系统版本，然后添加相应的仓库。</p>
<pre tabindex="0"><code>$ sudo apt-get -y install apt-transport-https ca-certificates curl
$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
$ sudo add-apt-repository &#34;deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable&#34;
$ sudo apt-get update
</code></pre><p>第二步：获取Docker CE</p>
<pre tabindex="0"><code>$ sudo apt-get install -y docker-ce
</code></pre><p>第三步：检查Docker版本，查看是否安装成功。</p>
<pre tabindex="0"><code>$ docker --version
# Docker version 17.04.0-ce, build 4845c56
</code></pre><p>第四步：建立Docker用户组</p>
<p>默认情况下，docker命令使用Unix Socket与Docker Daemon通信，而只有root用户和docker组用户才可以与Docker Daemon的Unix Socket建立通信。因此，出于安全考虑，我们可以将使用docker的用户加入Docker用户组。</p>
<pre tabindex="0"><code># 建立docker用户组
$ sudo groupadd docker
# 将当前用户加入docker用户组
$ sudo usermod -aG docker $USER
</code></pre><h3 id="4docker网络">4.Docker网络</h3>
<p>Docker使用-p参数指定网络端口，将宿主主机的端口与容器中的端口形成映射关系。容器的连接(linking)系统是除了端口映射外，另一种与容器中应用的方式。<strong>连接系统可以在源和接收容器之间创建一个隧道，接收容器可以看到源容器指定的信息，而且不用映射容器的端口到宿主主机上</strong>。</p>
<p>Docker通过2种方式为容器公开连接信息：</p>
<ul>
<li>环境变量</li>
<li>更新/etc/hosts文件</li>
</ul>
<p><strong>高级网络配置</strong></p>
<p>当Docker启动时，自动在宿主机上创建一个<code>docker0</code>虚拟网桥，实际上是Linux的一个网桥，对挂载到它的网口进行数据转发。同时，Docker随机分配一个本地未占用的私有网段中的一个地址给<code>docker0</code>接口。</p>
<p>当创建一个Docker容器的时候，同时会创建一对<code>veth pair</code>接口(虚拟网络设备对：即一对端口，当数据包发送到一个端口时，另一个端口也可以收到相同的数据包)。这对接口一端在容器内，即<code>eth0</code>；另一端在本地并被挂载到<code>docker0</code>网桥，名称以<code>veth</code>开头。通过这种方式，主机可以跟容器通信，容器之间也可以通信。</p>
<p>
        <img class="mx-auto" alt="Docker网络" src="http://on64c9tla.bkt.clouddn.com/Comput/docker_network.png" />   
    </p>

        </div>

        
<div class="post-archive">
    <ul class="post-copyright">
        <li><strong>原文作者：</strong><a rel="author" href="http://www.subond.com/">Kevin</a></li>
        <li style="word-break:break-all"><strong>原文链接：</strong><a href="http://www.subond.com/post/2017-04-14_docker_docker/">http://www.subond.com/post/2017-04-14_docker_docker/</a></li>
        <li><strong>版权声明：</strong>本作品采用<a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可，非商业转载请注明出处（作者，原文链接），商业转载请联系作者获得授权。</li>
    </ul>
</div>
<br/>



        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/post/2017-03-21_learn_paxos/">深入理解Paxos算法</a></li>
        
        <li><a href="/post/2017-02-21_reading_and_writing/">读书写作那点事儿</a></li>
        
        <li><a href="/post/2016-12-15_the_middle_twenties/">二十五六岁</a></li>
        
        <li><a href="/post/2016-10-07_reply-1988/">Reply 1988: 人生是个迷啊</a></li>
        
        <li><a href="/post/2016-06-19_linux_process2/">Linux中的线程管理</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='/tags/cloud' target="_blank">cloud</a></li>
                
                <li><a href='/tags/docker' target="_blank">docker</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
    
    

</div>

                    <footer id="footer">
    <div>
        &copy; 2023 <a href="http://www.subond.com/">凯文的个人博客 By Kevin</a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        <div class="github-badge">
            <a href="https://www.flysnow.org/" target="_black"><span class="badge-subject">Design by</span><span class="badge-value bg-brightgreen">飞雪无情</span></a>
        </div>
        <div class="github-badge">
            <a href="https://github.com/flysnow-org/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>
</footer>


    
    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>
<style type="text/css">
div.highlight {
    position: relative;
    margin: 1em 0px;
}

.copy-code {
    display: none;
    position: absolute;
    top: 4px;
    right: 4px;
    color: rgba(255, 255, 255, 0.8);
    background: rgba(78, 78, 78, 0.8);
    border-radius: var(--radius);
    padding: 0 5px;
    font: inherit;
    user-select: none;
    cursor: pointer;
    border: 0;
    --radius: 8px;
}

div.highlight:hover .copy-code,pre:hover .copy-code {
    display: block;
}

</style>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>


    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='http://www.subond.com/search' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="http://www.subond.com/">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="http://www.subond.com/post/2023-07-07_go_range/" title="《Go 细节和小技巧100》阅读记录" target="_blank">《Go 细节和小技巧100》阅读记录</a>
    </li>
    
    <li>
        <a href="http://www.subond.com/post/2023-06-30_13letter/" title="No.13 复利之谜" target="_blank">No.13 复利之谜</a>
    </li>
    
    <li>
        <a href="http://www.subond.com/post/2023-06-25_12letter/" title="No.12 你会做锅包肉吗？" target="_blank">No.12 你会做锅包肉吗？</a>
    </li>
    
    <li>
        <a href="http://www.subond.com/post/2023-06-21_offload/" title="聊聊网络卸载技术" target="_blank">聊聊网络卸载技术</a>
    </li>
    
    <li>
        <a href="http://www.subond.com/post/2023-06-12_wang_er/" title="《王二的经济学故事》读后感" target="_blank">《王二的经济学故事》读后感</a>
    </li>
    
    <li>
        <a href="http://www.subond.com/post/2023-06-07_11letter/" title="No.11 没有不出错的系统" target="_blank">No.11 没有不出错的系统</a>
    </li>
    
    <li>
        <a href="http://www.subond.com/post/2023-05-08_10letter/" title="No.10 往前看，别回头" target="_blank">No.10 往前看，别回头</a>
    </li>
    
    <li>
        <a href="http://www.subond.com/post/2023-05-06_10_mental_models/" title="[译文]关于学习的10种心智模型" target="_blank">[译文]关于学习的10种心智模型</a>
    </li>
    
    <li>
        <a href="http://www.subond.com/post/2023-04-10_how-to-get-rich/" title="No.9 [译文]如何致富" target="_blank">No.9 [译文]如何致富</a>
    </li>
    
    <li>
        <a href="http://www.subond.com/post/2023-04-03_08letter/" title="No.8 滑动门时刻" target="_blank">No.8 滑动门时刻</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href='/categories/'>分类</a></h3>
<ul class="widget-list">
    
    <li><a href="http://www.subond.com/categories/go%E7%AC%94%E8%AE%B0/">Go笔记 (1)</a></li>
    
    <li><a href="http://www.subond.com/categories/go%E9%AB%98%E6%80%A7%E8%83%BD%E7%BC%96%E7%A8%8B/">Go高性能编程 (7)</a></li>
    
    <li><a href="http://www.subond.com/categories/%E6%8A%80%E6%9C%AF/">技术 (23)</a></li>
    
    <li><a href="http://www.subond.com/categories/%E6%95%A3%E6%96%87/">散文 (10)</a></li>
    
    <li><a href="http://www.subond.com/categories/%E9%B8%BF%E9%9B%81%E4%BC%A0%E4%B9%A6/">鸿雁传书 (13)</a></li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href='/tags/'>标签</a></h3>
<div class="tagcloud">
    
    <a href="http://www.subond.com/tags/algorithm/">algorithm</a>
    
    <a href="http://www.subond.com/tags/alignment/">alignment</a>
    
    <a href="http://www.subond.com/tags/carrer/">carrer</a>
    
    <a href="http://www.subond.com/tags/cloud/">cloud</a>
    
    <a href="http://www.subond.com/tags/defer/">defer</a>
    
    <a href="http://www.subond.com/tags/distributed-systems/">distributed systems</a>
    
    <a href="http://www.subond.com/tags/docker/">docker</a>
    
    <a href="http://www.subond.com/tags/essay/">essay</a>
    
    <a href="http://www.subond.com/tags/git/">git</a>
    
    <a href="http://www.subond.com/tags/gitbook/">gitbook</a>
    
    <a href="http://www.subond.com/tags/go/">go</a>
    
    <a href="http://www.subond.com/tags/golang/">golang</a>
    
    <a href="http://www.subond.com/tags/growth/">growth</a>
    
    <a href="http://www.subond.com/tags/life/">life</a>
    
    <a href="http://www.subond.com/tags/linux/">linux</a>
    
    <a href="http://www.subond.com/tags/mutex/">mutex</a>
    
    <a href="http://www.subond.com/tags/process/">process</a>
    
    <a href="http://www.subond.com/tags/pthread/">pthread</a>
    
    <a href="http://www.subond.com/tags/reading/">reading</a>
    
    <a href="http://www.subond.com/tags/slice/">slice</a>
    
    <a href="http://www.subond.com/tags/string/">string</a>
    
    <a href="http://www.subond.com/tags/struct/">struct</a>
    
    <a href="http://www.subond.com/tags/vagrant/">vagrant</a>
    
    <a href="http://www.subond.com/tags/work/">work</a>
    
    <a href="http://www.subond.com/tags/writing/">writing</a>
    
    <a href="http://www.subond.com/tags/%E4%BA%BA%E7%94%9F%E4%BF%A1%E5%BF%B5/">人生信念</a>
    
    <a href="http://www.subond.com/tags/%E5%86%85%E5%9C%A8%E8%AE%B0%E5%88%86%E7%89%8C/">内在记分牌</a>
    
    <a href="http://www.subond.com/tags/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/">内存管理</a>
    
    <a href="http://www.subond.com/tags/%E5%86%99%E4%BD%9C/">写作</a>
    
    <a href="http://www.subond.com/tags/%E5%AD%A6%E4%B9%A0/">学习</a>
    
    <a href="http://www.subond.com/tags/%E5%BF%83%E7%90%86%E5%AD%A6/">心理学</a>
    
    <a href="http://www.subond.com/tags/%E6%80%9D%E8%80%83/">思考</a>
    
    <a href="http://www.subond.com/tags/%E6%83%85%E6%84%9F/">情感</a>
    
    <a href="http://www.subond.com/tags/%E7%90%86%E8%B4%A2/">理财</a>
    
    <a href="http://www.subond.com/tags/%E7%94%9F%E6%B4%BB/">生活</a>
    
    <a href="http://www.subond.com/tags/%E7%BB%8F%E6%B5%8E/">经济</a>
    
    <a href="http://www.subond.com/tags/%E7%BD%91%E7%BB%9C%E5%8D%B8%E8%BD%BD/">网络卸载</a>
    
    <a href="http://www.subond.com/tags/%E9%98%85%E8%AF%BB/">阅读</a>
    
</div>
    </section>

    
<section class="widget">
    <h3 class="widget-title">友情链接</h3>
    <ul class="widget-list">
        
        <li>
            <a target="_blank" href="http://github.com/yusubond" title="github">Github</a>
        </li>
        
        <li>
            <a target="_blank" href="https://weibo.cn/u/2746421033" title="微博">微博</a>
        </li>
        
    </ul>
</section>


    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="http://www.subond.com/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
</body>

</html>